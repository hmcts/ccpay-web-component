
@if (isBackButtonEnable) {
  <div class="govuk-breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      @if (!isTurnOff) {
        <li class="govuk-breadcrumbs__list-item">
          <a (click)="loadCaseTransactionPage()" class="govuk-back-link govuk-label">Back</a>
        </li>
      }
      @if (isTurnOff) {
        <li class="govuk-breadcrumbs__list-item">
          <a (click)="redirectToFeeSearchPage($event,'summary')" class="govuk-back-link govuk-label">Back</a>
        </li>
      }
    </ol>
  </div>
}
@if (viewStatus === 'main') {
  <div class="fee-summary">
    <main class="govuk-main-wrapper">
      <input #myInput type='hidden' class='iFrameDrivenImageValue' value='FEESUMMARY'>
      <div class="summaryheader">
        <h1 class="heading-large govuk-!-margin-top-3 govuk-!-margin-bottom-4">Summary </h1>
        <p class="govuk-!-margin-top-5 caseref">Case reference:{{ccdCaseNumber | ccdHyphens}}</p>
      </div>
      <!-- <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="heading-xlarge">Fee Summary</h1>
      </div>
      <div class="govuk-grid-column-one-third" align="right">
        <button  *ngIf="!isTurnOff" (click)="redirectToFeeSearchPage($event,'summary')"
          [disabled]="isPaymentExist"
          [ngClass]='isPaymentExist ? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'>
          Add a new fee
        </button>
        <a *ngIf="isTurnOff" (click)="redirectToFeeSearchPage($event,'summary')" class="button">Add a new fee</a>
      </div>
    </div> -->
    @if (errorMessage) {
      <div>
        <div class="error-summary" role="group" aria-labelledby="failure-error-summary-heading" tabindex="-1">
          <h2 class="heading-medium error-summary-heading" id="failure-error-summary-heading">
            Payment Group details could not be retrieved
          </h2>
          <div class="govuk-error-summary__body">
            {{ errorMessage }}
          </div>
        </div>
      </div>
    }
    <div class="govuk-!-margin-top-3">
      @if (!errorMessage && paymentGroup) {
        <table class="govuk-table  govuk-!-margin-bottom-2">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th class="govuk-table__header" scope="col" class="class600">Description</th>
              <th class="govuk-table__header" scope="col" class="class60">Quantity</th>
              <th class="govuk-table__header" scope="col" class="class80"></th>
              <th class="govuk-table__header" scope="col" class="class100">Amount</th>
            </tr>
          </thead>
          @if (paymentGroup.fees) {
            <tbody class="govuk-table__body">
              @for (fee of paymentGroup.fees; track fee; let i = $index) {
                <tr class="govuk-table__row">
                  <td class="govuk-table__cell">{{ fee.description }}
                    @if ((isPaymentExist || (getRemissionByFeeCode(fee.code)?.hwf_amount === 0 || !getRemissionByFeeCode(fee.code)?.hwf_amount)) && !isTurnOff) {
                      <span class="no-border">
                        @if ((!isPaymentExist || !getRemissionByFeeCode(fee.code))) {
                          <a (click)="confirmRemoveFee(fee)" [ngClass]='isPaymentExist || getRemissionByFeeCode(fee.code)? "disable-link" : ""'> <br>Remove</a>
                        }
                      </span>
                    }
                    @if ((!isPaymentExist || (getRemissionByFeeCode(fee.code)?.hwf_amount === 0 || !getRemissionByFeeCode(fee.code)?.hwf_amount)) && isTurnOff ) {
                      <span class="no-border">
                        <a (click)="confirmRemoveFee(fee)">Remove</a>
                      </span>
                    }
                    @if ((getRemissionByFeeCode(fee.code)?.hwf_amount === 0 || !getRemissionByFeeCode(fee.code)?.hwf_amount) && !isPaymentExist && !isTurnOff) {
                      <a (click)="addRemission(fee)" class="remissionActive" >
                        Add help with fees or remission
                      </a>
                    }
                    @if ((getRemissionByFeeCode(fee.code)?.hwf_amount === 0 || !getRemissionByFeeCode(fee.code)?.hwf_amount) && isTurnOff) {
                      <a (click)="addRemission(fee)" class="remissionActive"  >
                        Add help with fees or remission
                      </a>
                    }
                  </td>
                  @if (fee.volume && fee.volume > 0) {
                    <td class="govuk-table__cell">
                      {{ fee.volume }}
                    </td>
                  }
                  <td  class="govuk-table__cell alignright">
                    <br>
                    </td>
                    <td class="govuk-table__cell alignright" >
                      {{ fee.calculated_amount | currency:'GBP':'symbol-narrow':'1.2-2' }}
                    </td>
                  </tr>
                  @if (getRemissionByFeeCode(fee.code)?.hwf_amount > 0) {
                    <tr class="govuk-table__row">
                      <td>
                        <div>Remission {{ getRemissionByFeeCode(fee.code)?.hwf_reference }}</div>
                      </td>
                      <td>
                        <div>1</div>
                      </td>
                      <td>
                        <div></div>
                      </td>
                      <td>
                        <div style="text-align: right;">
                          -{{ getRemissionByFeeCode(fee.code)?.hwf_amount? ( getRemissionByFeeCode(fee.code)?.hwf_amount  | currency:'GBP':'symbol-narrow':'1.2-2') : '-' }}
                        </div>
                      </td>
                    </tr>
                  }
                }
              </tbody>
            }
          </table>
        }
      </div>
      <div class="addfee">
        @if (!isTurnOff) {
          <button  (click)="redirectToFeeSearchPage($event,'summary')"
            [disabled]="isPaymentExist"
            [ngClass]='isPaymentExist ? "govuk-button govuk-button--secondary button--disabled" : "govuk-button govuk-button--secondary"'>
            Add fee
          </button>
        }
        @if (isTurnOff) {
          <a (click)="redirectToFeeSearchPage($event,'summary')" class="govuk-button govuk-button--secondary">Add a new fee</a>
        }
        <div  class="feeAddButton">
          <p class="paddigleft govuk-!-margin-top-2">Total to pay: {{ outStandingAmount | currency:'GBP':'symbol-narrow':'1.2-2'}}</p>
        </div>
      </div>
      <!--
      <div class="govuk-form-group govuk-form-group--mg" *ngIf="!bsPaymentDcnNumber">
        <label class="govuk-label custom-govuk-label govuk-fieldset__heading--fz" for="responsibleOffice">
          <strong>What service is this fee for?</strong>
        </label>
        <select class="govuk-select govuk-select--custom" id="responsibleOffice" [(ngModel)]="service" name="responsibleOffice">
          <option value="" selected='selected'>Please select</option>
          <option value="AA07">Divorce</option>
          <option value="AA09">Financial Remedy</option>
          <option value="AA08">Probate</option>
        </select>
      </div> -->
      <div>
        @if (!bsPaymentDcnNumber) {
          <button type="submit" (click)="takePayment()"
            [disabled]="totalFee <= 0 || isConfirmationBtnDisabled"
            [ngClass]='totalFee <= 0 || !platForm || !service || isConfirmationBtnDisabled? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'>
            Take payment
          </button>
        }
        @if (bsPaymentDcnNumber) {
          <button type="button" (click)="goToAllocatePage(outStandingAmount, isFeeAmountZero)" class="button govuk-!-margin-right-1">
            @if (outStandingAmount > 0 || (isFeeAmountZero && outStandingAmount === 0)) {
              <span class="white">
                Allocate payment
              </span>
            }
            @if (outStandingAmount < 0 || (!isFeeAmountZero && outStandingAmount === 0)) {
              <span class="white">
                Continue
              </span>
            }
          </button>
        }
      </div>
    </main>
  </div>
}

@if (viewStatus === 'feeRemovalConfirmation') {
  <input #myInput type='hidden' class='iFrameDrivenImageValue' value='FEEREMOVALCONFIRMATION_1'>
  <div class="govuk-warning-text">
    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
    <strong class="govuk-warning-text__text">
      <span class="govuk-warning-text__assistive">Warning</span>
      Are you sure you want to delete this fee?
    </strong>
  </div>
  <div class="govuk-button-grb">
    <form novalidate>
      <button type="submit" class="button govuk-button--secondary" (click)="cancelRemission()">
        Cancel
      </button>
      @if (!isRemoveBtnDisabled) {
        <button type="submit" class="button"
          [ngClass]='isRemoveBtnDisabled ? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'
          (click)="removeFee(currentFee)">
          Remove
        </button>
      }
    </form>
  </div>
}
@if (viewStatus === 'add_remission' && currentFee) {
  <ccpay-add-remission
    [isTurnOff]="isTurnOff"
    [isStrategicFixEnable]="isStrategicFixEnable"
    [fee]="currentFee"
    [caseType]="caseType"
    [ccdCaseNumber]="ccdCaseNumber"
    [paymentGroupRef]="paymentGroupRef"
  (cancelRemission)="cancelRemission()"></ccpay-add-remission>
}
@if (viewStatus === 'payhub_view' && payhubHtml) {
  <input #myInput type='hidden' class='iFrameDrivenImageValue' value='PCIPAL'>
}
