<fieldset class="govuk-fieldset contact-details--size">
  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
  <div class="govuk-form-group">
    <legend class="govuk-fieldset__legend govuk-fieldset__legend--s govuk-font19px">
      {{ isEditOperation ? 'Edit contact information' : 'Contact information' }}
    </legend>
    <div id="contact-hint" class="govuk-hint govuk-font19px">
      Notifications will be sent via email or post when this refund is issued or rejected. You can only choose one option.
    </div>
    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset">
        <div class="govuk-radios govuk-radios--conditional" data-module="govuk-radios">
          <div class="govuk-radios__item">
            <input class="govuk-radios__input" id="contact" name="contact" (click)="selectContactOption('Email', 'false')" type="radio" value="email" [checked]="isEmailSAddressClicked"  aria-controls="conditional-contact" aria-expanded="true">
            <label class="govuk-label govuk-radios__label govuk-font19px" for="contact">
              Email
            </label>
          </div>
          @if (isEmailSAddressClicked) {
            <div class="govuk-radios__conditional" id="conditional-contact-email">
              <form [formGroup]="emailAddressForm" novalidate>
                <div class="govuk-form-group">
                  <label class="govuk-label " for="email">
                    <span class="govuk-hint govuk-font19px">Information about this refund will be sent to this email address.</span>
                  </label>
                  <div id="email-hint" class="govuk-hint">
                  </div>
                  <input class="govuk-input govuk-font19px" id="email" name="" type="email" [ngClass]="{ 'inline-error-class': isEmailEmpty || emailHasError }" value="{{addressObj?.contact_details?.email}}" formControlName="email" aria-describedby="email-hint">
                  @if (isEmailEmpty || emailHasError) {
                    <p class="inline-error-message">
                      @if (isEmailEmpty) {
                        <span>Enter a email address.</span>
                      }
                      @if (emailHasError) {
                        <span>Enter a valid email address.</span>
                      }
                    </p>
                  }
                </div>
              </form>
            </div>
          }
          <div class="govuk-radios__item">
            <input class="govuk-radios__input" id="contact-2" name="contact" (click)="selectContactOption('Postcode', 'false')" type="radio" [checked]="isPostcodeClicked" value="post" aria-controls="conditional-contact-2" aria-expanded="false">
            <label class="govuk-label govuk-radios__label govuk-font19px" for="contact-2">
              Post
            </label>
          </div>
          @if (isPostcodeClicked && !isManualAddressClicked) {
            <div class="govuk-radios__conditional" id="conditional-contact-postcode">
              <form [formGroup]="postCodeForm" novalidate>
                <label class="govuk-label govuk-font19px" for="address-postcode">
                  <span class="govuk-hint govuk-font19px">Information about this refund will be sent to this address.</span>Postcode
                </label>
                <div class="postcode-align-css">
                  <div class="govuk-form-group govuk-margin-right-10px">
                    <input class="govuk-input govuk-input--width-10" id="address-postcode" name="address-postcode" [ngClass]="{ 'inline-error-class': isPostcodeEmpty || postcodeHasError }" formControlName="postcode" type="text" autocomplete="postal-code">
                    @if (isPostcodeEmpty || postcodeHasError) {
                      <p class="inline-error-message">
                        @if (isPostcodeEmpty) {
                          <span>Enter a postcode.</span>
                        }
                        @if (postcodeHasError) {
                          <span>Enter a valid postcode.</span>
                        }
                      </p>
                    }
                  </div>
                  <div class="govuk-button-group">
                    <button class="govuk-button govuk-button--secondary govuk-font19px" (click)="postcodeValidation('FA')" data-module="govuk-button">
                      Find address
                    </button>
                  </div>
                </div>
              </form>
              @if (isShowPickAddress) {
                <div class="govuk-form-group govuk-margin-btm-20px">
                  <label class="govuk-label govuk-font19px" for="country">
                    Pick an address
                  </label>
                  <select class="govuk-select govuk-font19px" [(ngModel)]="postcodeAddress" id="postcodeAddress" [ngClass]="{ 'inline-error-class': isAddressBoxEmpty }" name="postcodeAddress">
                    @for (address of addressPostcodeList; track address) {
                      <option [ngValue]="address.DPA" > {{address.DPA.ADDRESS}}</option>
                    }
                  </select>
                  @if (isAddressBoxEmpty) {
                    <p class="inline-error-message">
                      @if (isAddressBoxEmpty) {
                        <span>Please select an address.</span>
                      }
                    </p>
                  }
                </div>
              }
              <details class="govuk-details" data-module="govuk-details">
                <summary class="govuk-details__summary">
                  <span class="govuk-details__summary-text govuk-font19px">
                    <a href="Javascript:void(0);" (click)="selectContactOption('Postcode', 'true')">  Enter address manually</a>
                  </span>
                </summary>
              </details>
            </div>
          }
          @if (isPostcodeClicked && isManualAddressClicked) {
            <div class="govuk-radios__conditional" id="conditional-contact-manual">
              <form [formGroup]="manualAddressForm" novalidate>
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-font19px" for="address-line-1">
                    <span class="govuk-hint govuk-font19px">Information about this refund will be sent to this address.</span>Building and street <span class="govuk-visually-hidden">line 1 of 2</span>
                  </label>
                  <input class="govuk-input govuk-font19px" id="address-line-1" name="address-line-1" [ngClass]="{ 'inline-error-class': isaddressLine1Empty || addressLine1HasError }" value="{{addressObj?.contact_details?.address_line}}" formControlName="addressl1" type="text" autocomplete="address-line1">
                  @if (isaddressLine1Empty || addressLine1HasError) {
                    <p class="inline-error-message">
                      @if (isaddressLine1Empty) {
                        <span>Enter a Building and street.</span>
                      }
                      @if (addressLine1HasError) {
                        <span>Enter a valid Building and street.</span>
                      }
                    </p>
                  }
                </div>
                <div class="govuk-form-group">
                  <label class="govuk-label" for="address-line-2">
                    <span class="govuk-visually-hidden govuk-font19px">Building and street line 2 of 2</span>
                  </label>
                  <input class="govuk-input govuk-font19px" id="address-line-2" name="address-line-2" [ngClass]="{ 'inline-error-class': addressLine2HasError}" formControlName="addressl2" type="text" autocomplete="address-line2">
                  @if (addressLine2HasError) {
                    <p class="inline-error-message">
                      @if (addressLine2HasError) {
                        <span>Enter a valid Building and street line 2 of 2.</span>
                      }
                    </p>
                  }
                </div>
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-font19px" for="address-town">
                    Town or city
                  </label>
                  <input class="govuk-input govuk-!-width-two-thirds govuk-font19px" id="address-town" name="address-town" [ngClass]="{ 'inline-error-class': isTownOrCityEmpty || townOrCityHasError}" value="{{addressObj?.contact_details?.city}}" formControlName="townorcity" type="text" autocomplete="address-level2">
                  @if (isTownOrCityEmpty || townOrCityHasError) {
                    <p class="inline-error-message">
                      @if (isTownOrCityEmpty) {
                        <span>Enter a town or city.</span>
                      }
                      @if (townOrCityHasError) {
                        <span>Enter a town or city.</span>
                      }
                    </p>
                  }
                </div>
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-font19px" for="address-county">
                    County
                  </label>
                  <input class="govuk-input govuk-!-width-two-thirds govuk-font19px" id="address-county" [ngClass]="{ 'inline-error-class': isCountyEmpty || countyHasError}" value="{{addressObj?.contact_details?.county}}" formControlName="county" name="address-county" type="text">
                  @if (isCountyEmpty || countyHasError) {
                    <p class="inline-error-message">
                      @if (isCountyEmpty) {
                        <span>Enter a County.</span>
                      }
                      @if (countyHasError) {
                        <span>Enter a valid County.</span>
                      }
                    </p>
                  }
                </div>
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-font19px" for="address-postcode">
                    Postcode
                  </label>
                  <input class="govuk-input govuk-input--width-10 govuk-font19px" id="address-postcode" formControlName="mpostcode" name="address-postcode" [ngClass]="{ 'inline-error-class': isMPostcodeEmpty || mpostcodeHasError}" value="{{addressObj?.contact_details?.postal_code}}" type="text" autocomplete="postal-code">
                  @if (isMPostcodeEmpty || mpostcodeHasError) {
                    <p class="inline-error-message">
                      @if (isMPostcodeEmpty) {
                        <span>Enter a postcode.</span>
                      }
                      @if (mpostcodeHasError) {
                        <span>Enter a valid postcode.</span>
                      }
                    </p>
                  }
                </div>
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-font19px" for="country">
                    Country
                  </label>
                  <select class="govuk-select govuk-font19px" id="country" name="country" [ngClass]="{'inline-error-class': isCountryEmpty}" formControlName="country">
                    <option value="" selected="selected">Please select</option>
                    <option value="United Kingdom" selected="{{ addressObj?.contact_details?.country ? 'selected' : '' }}">United Kingdom</option>
                  </select>
                  @if (isCountryEmpty) {
                    <p class="inline-error-message">
                      @if (isCountryEmpty) {
                        <span>Select a Country.</span>
                      }
                    </p>
                  }
                </div>
              </form>
            </div>
          }
        </div>
      </fieldset>
    </div>
    <!---FORM--->
  </div>

  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
</fieldset>
<div class="govuk-button-group">
  <button type="submit" class="button govuk-button--secondary govuk-font19px" (click)="redirection($event)"> Previous </button>
  &nbsp;
  <button type="submit" class="button govuk-button govuk-font19px" (click)="finalFormSubmit()">
    Continue
  </button>
</div>