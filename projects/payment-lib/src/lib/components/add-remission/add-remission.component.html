<div class="add-remission">
    <div *ngIf="errorMessage">
      <div class="error-summary" role="group" aria-labelledby="failure-error-summary-heading" tabindex="-1">
        <h2 class="heading-medium error-summary-heading" id="failure-error-summary-heading">
          Error in processing the request
        </h2>
        <div class="govuk-error-summary__body">
          {{ errorMessage }}
        </div>
      </div>
    </div>
  <ng-container *ngIf="viewStatus === 'main' && !isRefundRemission ">
      <input #myInput type='hidden' id='iFrameDrivenImageValue' value='ADDREMISSION'>
      <h1 class="heading-large">Add remission </h1>
      <form novalidate>
        <div class="govuk-form-group">
          <form [formGroup]="remissionForm" novalidate>
            <div class="govuk-form-group">
              <label class="govuk-label govuk-label--s" for="remission-code">
                  Add remission to {{ fee.code }}: {{ fee.description }}
                <span class="form-hint">Enter remission for reference. For example: HWF-A1B-23C</span>
              </label>
              <input [ngClass]="{'inline-error-class': isRemissionCodeEmpty || remissionCodeHasError}" class="govuk-input govuk-input--width-20 govuk-!-margin-right-1" id="remissionCode" aria-label="remissionCode"  name="remissionCode" type="text" formControlName="remissionCode">
              <p class="inline-error-message" *ngIf="isRemissionCodeEmpty || remissionCodeHasError">
                <span *ngIf="isRemissionCodeEmpty">Enter a remission code</span>
                <span *ngIf="remissionCodeHasError">Enter a vaild remission code</span>
              </p>
            </div>
            <div class="govuk-form-group">
              <label class="govuk-label govuk-label--s" for="amount">
                How much does the applicant need to pay?
              </label>

              <div id="amount-currency" class="govuk-visually-hidden">in pounds</div>
                <div class="hmcts-currency-input">
                <div class="hmcts-currency-input__symbol" aria-hidden="true">£</div>
                <input class="govuk-input govuk-input--width-10" [ngClass]="{'inline-error-class': isAmountEmpty || amountHasError || isRemissionLessThanFeeError}" id="amount" aria-label="amount"  name="amount" type="text" aria-describedby="amount-currency" formControlName="amount">
                <p class="inline-error-message" *ngIf="isAmountEmpty || amountHasError || isRemissionLessThanFeeError">
                  <span *ngIf="isAmountEmpty">Enter a amount</span>
                  <span *ngIf="amountHasError">Enter a vaild amount</span>
                  <span *ngIf="isRemissionLessThanFeeError">The remission amount must be less than the total fee</span>
                </p>
              </div>
            </div>
          </form>
          <button class="button" type="submit" (click)="addRemission()">
              Submit
            </button>
        </div>
      </form>
  </ng-container>
  <ng-container *ngIf="viewStatus === 'confirmation'">
      <input #myInput type='hidden' id='iFrameDrivenImageValue' value='ADDREMISSIONCONFIRMATION'> 
      <div class="govuk-warning-text">
        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">Warning</span>
          Are you sure you want to add remission to this fee?
        </strong>
      </div>
      <table class="govuk-table">
        <tr class="govuk-table__row">
            <td class="govuk-table__cell govuk-!-font-weight-bold">Remission code:</td>
            <td class="govuk-table__cell">{{ remissionForm.controls.remissionCode.value }}</td>
        </tr>
        <tr class="govuk-table__row">
            <td class="govuk-table__cell govuk-!-font-weight-bold">Fee code:</td>
            <td class="govuk-table__cell">{{ fee.code }}</td>
        </tr>
        <tr class="govuk-table__row">
            <td class="govuk-table__cell govuk-!-font-weight-bold">Fee description:</td>
            <td class="govuk-table__cell">{{ fee.description }}</td>
        </tr>
        <tr class="govuk-table__row">
            <td class="govuk-table__cell govuk-!-font-weight-bold">Amount the applicant must pay:</td>
            <td class="govuk-table__cell">{{  remissionForm.controls.amount.value  | currency:'GBP':'symbol-narrow':'1.2-2' }}</td>
        </tr>
      </table>

      <button type="submit" class="button govuk-button--secondary" (click)="cancelRemission.emit()">
        Cancel
      </button>
      <button type="submit"
      [disabled]="isConfirmationBtnDisabled"
      [ngClass]='isConfirmationBtnDisabled ? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'
      (click)="confirmRemission()">
        Confirm
      </button>

  </ng-container>
  <ng-container *ngIf="viewCompStatus === 'addremission' && isRefundRemission">
      <h1 class="heading-large">Process remission</h1>
      <h1 class="heading-medium">#{{ccdCaseNumber}}</h1>
      <h1 class="heading-large">Enter help with fees or remission reference</h1>
      <form novalidate>
          <div class="govuk-form-group">
            <form [formGroup]="remissionForm" novalidate>
              <div class="govuk-form-group">
                <label class="govuk-label govuk-label--s" for="remission-code">
                  <span class="form-hint">For example: HWF-A1B-23C</span>
                </label>
                <input [ngClass]="{'inline-error-class': isRemissionCodeEmpty || remissionCodeHasError}" class="govuk-input govuk-input--width-20 govuk-!-margin-right-1" id="remissionCode" aria-label="remissionCode"  name="remissionCode" type="text" formControlName="remissionCode">
                <p class="inline-error-message" *ngIf="isRemissionCodeEmpty || remissionCodeHasError">
                  <span *ngIf="isRemissionCodeEmpty">Enter a remission code</span>
                  <span *ngIf="remissionCodeHasError">Enter a vaild remission code</span>
                </p>
              </div>
            
            </form>
            <div class="govuk-button-group">
                <button (click)="gotoCasetransationPage()" class="govuk-button govuk-button--secondary"> Previous</button>
                <button (click)="addRemissionCode()" class="govuk-button"> Continue</button>
<!-- 
                <a (click) ="gotoCasetransationPage()" role="button" draggable="false" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                Previous
              </a>
              <a (click)="addRemissionCode()" role="button" draggable="false" class="govuk-button" data-module="govuk-button">
                Continue
              </a> -->
              <p>
                  <a (click)="gotoCasetransationPage()" class="govuk-link" data-module="govuk-button">
                      Cancel
                  </a>
              </p>
            </div>
          </div>
      </form>

  </ng-container>

  <ng-container *ngIf="viewStatus === 'applyremissioncode'" >
      <h1 class="heading-large">Process remission</h1>
      <h1 class="heading-medium">#{{ccdCaseNumber}}</h1>
      <div class="govuk-form-group">
          <form novalidate>
              <div class="govuk-form-group">
                  <form [formGroup]="remissionForm" novalidate>
                      <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                        <h1 class="heading-medium">
                            Do you want to give a full remission of {{ amount | currency:'GBP':'symbol-narrow':'1.2-2' }} 
                        </h1> 
                      </legend>
                      <div class="govuk-radios govuk-radios--conditional" data-module="govuk-radios">
                        <div class="govuk-radios__item">
                          <input 
                          id="yes"
                          class="govuk-radios__input"
                          name="RemissionSelection"
                          type="radio"
                          value="yes" 
                          (change)= "onSelectionChange('yes')"
                          [checked]='true' 
                          data-aria-controls="yes"/>
                          <label class="govuk-label govuk-radios__label govuk-label--m" for="yes">
                              Yes
                          </label>
            
                        </div>
            
                        <div class="govuk-radios__item" >
                            <input class="govuk-radios__input" 
                              id="No"
                              aria-label ="No"
                              name="RemissionSelection"
                              type="radio"
                              value="No" 
                              (change)= "onSelectionChange('No')"
                              data-aria-controls="No"
                              />
                              <label class="govuk-label govuk-radios__label govuk-label--m" for="No">
                                No
                            </label>
                        </div>

                        <div class="govuk-radios__conditional" *ngIf="selectedValue === 'No'" >
                              <label class="govuk-label govuk-label--m" for="amount">
                                  How much do you want to refund?
                              </label>
                              <div id="amount-currency" class="govuk-visually-hidden">in pounds</div>
                <div class="hmcts-currency-input">
                <div class="hmcts-currency-input__symbol" aria-hidden="true">£</div>
                <input class="govuk-input govuk-input--width-10" [ngClass]="{'inline-error-class': isAmountEmpty || amountHasError || isRemissionLessThanFeeError}" id="amount" aria-label="amount"  name="amount" type="text" aria-describedby="amount-currency" formControlName="amount">
                <p class="inline-error-message" *ngIf="isAmountEmpty || amountHasError || isRemissionLessThanFeeError">
                  <span *ngIf="isAmountEmpty">Enter a amount</span>
                  <span *ngIf="amountHasError">Enter a vaild amount</span>
                  <span *ngIf="isRemissionLessThanFeeError">The remission amount must be less than the total fee</span>
                </p>
              </div>
                        </div>
                      </div>
                      </fieldset>
                  </form>
            
                  <div class="govuk-button-group">
                      <button (click)="gotoremissionPage()" class="govuk-button govuk-button--secondary"> Previous</button>
                <button (click)="gotoConfirmationPage()" class="govuk-button"> Continue</button>
                    
                      <!-- <a (click) ="gotoremissionPage()" role="button" draggable="false" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                      Previous
                    </a>
                    <a (click)="gotoConfirmationPage()" role="button" draggable="false" class="govuk-button" data-module="govuk-button">
                      Continue
                    </a> -->
                    <p>
                        <a (click)="gotoCasetransationPage()" class="govuk-link" data-module="govuk-button">
                            Cancel
                        </a>
                    </p>
                  </div>
              </div>
    
          </form>
      </div>
  </ng-container>

  <ng-container *ngIf="viewStatus === 'remissionconfirmation'">
      <input #myInput type='hidden' id='iFrameDrivenImageValue' value='ADDREMISSIONCONFIRMATION'> 
      <div class="govuk-warning-text">
       
          <h1 class="heading-large"> Check your answers</h1>
      </div>
      <table class="govuk-table">
          <tr class="govuk-table__row">
              <td class="govuk-table__cell govuk-!-font-weight-bold">Payment reference</td>
              <td class="govuk-table__cell">{{paymentGroupRef}}</td>
          </tr>
          <tr class="govuk-table__row">
              <td class="govuk-table__cell govuk-!-font-weight-bold">Payment amount</td>
              <td class="govuk-table__cell">{{paidAmount}}</td>
          </tr>
          <tr class="govuk-table__row">
              <td class="govuk-table__cell govuk-!-font-weight-bold">Payment status</td>
              <td class="govuk-table__cell">{{orderStatus}}</td>
          </tr>
          <tr class="govuk-table__row">
              <td class="govuk-table__cell govuk-!-font-weight-bold">Fee</td>
              <td class="govuk-table__cell">{{ fee.code }} - {{ fee.description }} </td>
          </tr>
          <tr class="govuk-table__row">
              <td class="govuk-table__cell govuk-!-font-weight-bold">Help with fees or remission reference</td>
              <td class="govuk-table__cell"> {{ remissionForm.controls.remissionCode.value }}
               <a (click)="gotoremissionPage()" class="govuk-link right" >Change</a>
              </td>
          </tr>
          <tr class="govuk-table__row">
              <td class="govuk-table__cell govuk-!-font-weight-bold">Remission amount</td>
              <td class="govuk-table__cell" *ngIf="selectedValue === 'yes'">{{ amount | currency:'GBP':'symbol-narrow':'1.2-2' }} 
                  <a (click)="addRemissionCode()" class="govuk-link right" >Change</a>
              </td>
              <td class="govuk-table__cell" *ngIf="selectedValue === 'No' ">{{ (amount - remissionForm.controls.amount.value)  | currency:'GBP':'symbol-narrow':'1.2-2' }}
                  <a (click)="addRemissionCode()" class="govuk-link right" >Change</a>
              </td>
          </tr>
       
      </table>

      <button type="submit" class="button govuk-button--secondary" (click)="cancelRefundRemission()">
        Previous
      </button>
      <button type="submit"
      [disabled]="isConfirmationBtnDisabled"
      [ngClass]='isConfirmationBtnDisabled ? "button button--disabled govuk-!-margin-right-1" : "button govuk-!-margin-right-1"'
      (click)="confirmRemission()">
        Add remission
      </button>
      <p>
          <a (click)="gotoCasetransationPage()" class="govuk-link" data-module="govuk-button">
              Cancel
          </a>
      </p>

  </ng-container>

  <ng-container *ngIf="viewStatus === 'confirmationpage'">
    <div class="govuk-grid-row">
      <div >
        <div class="govuk-panel govuk-panel--confirmation">
          <h1 class="govuk-panel__title">
            Remission added
          </h1>
          
          <div class="govuk-panel__body">
            <p class="govuk-body" style="color: white"><strong>Refund reference: {{remissionReference}}</strong></p>
          </div>
    
        </div>
        <h2 class="govuk-heading-l">What happens next</h2>
        <p class="govuk-body">
          A refund request for {{paidAmount - (amount - remissionForm.controls.amount.value)}} has been created and will be passed to a team leader to approve.
        </p>
        <p class="govuk-body">
          <a (click)="gotoCasetransationPage()"  class="govuk-link">Return to case</a>
       </p>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="viewStatus === 'issueRefund'">
      <h1 class="heading-large">Process refund</h1>
      <h1 class="heading-medium">#{{ccdCaseNumber}}</h1>
      <h1 class="heading-large">Why are you making this refund?
        </h1>
        <div class="govuk-form-group">
            <fieldset class="govuk-fieldset" aria-describedby="how-contacted-conditional-hint">
              <div
                [ngClass]="refundHasError ? 'govuk-radios govuk-radios--conditional form-group-error' : 'govuk-radios govuk-radios--conditional'"
                data-module="govuk-radios" >
                <div class="govuk-radios__item" *ngFor="let refund of refund.reason | keyValue">
                  <input class="govuk-radios__input" id="{{refund.key}}" name="refund" type="radio"
                    [(ngModel)]="refundReason" value={{refund.value}}
                    (click)="selectRadioButton(refund.key, 'refund')">
                  <label class="govuk-label govuk-radios__label govuk-font__custom" for="how-contacted-conditional">
                    {{refund.value}}
                  </label>
                </div>
              </div>
    
            </fieldset>
          </div>
  </ng-container>

</div>

